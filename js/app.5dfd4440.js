(function(e){function t(t){for(var o,s,a=t[0],c=t[1],l=t[2],f=0,d=[];f<a.length;f++)s=a[f],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&d.push(r[s][0]),r[s]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);u&&u(t);while(d.length)d.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],o=!0,a=1;a<n.length;a++){var c=n[a];0!==r[c]&&(o=!1)}o&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var o={},r={app:0},i=[];function s(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=o,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(n,o,function(t){return e[t]}.bind(null,o));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var l=0;l<a.length;l++)t(a[l]);var u=c;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"1f96":function(e,t,n){"use strict";var o=n("4830"),r=n.n(o);r.a},4830:function(e,t,n){},"5e11":function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="5e11"},b383:function(e,t,n){},cd49:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("b383");var o,r=n("2b0e"),i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container flex-center"},[n("div",{staticClass:"container flex-center",class:{user:e.isClient,host:e.isHost}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.isHost,expression:"isHost"}],staticClass:"item flex-center"},[n("span",[e._v("Идентификатор сессии: "+e._s(e.sessionId))]),n("span",[e._v("Подключено пользователей: "+e._s(e.connectedUsersCount))])]),n("div",{staticClass:"item flex-center"},[n("div",{staticClass:"role"},[n("span",[e._v("Ваша роль")]),n("div",{staticClass:"image-role-container"},[e.userRole?n("img",{staticClass:"image-role",attrs:{src:e.userRole.link,title:e.userRole.name,alt:e.userRole.name}}):n("span",[e._v("[ Роль не выдана ]")])])]),n("div",{staticClass:"buttons"},[e.isClient?e._e():n("button",{attrs:{disabled:e.isHost},on:{click:e.serve}},[e._v("Создать сервер")]),e.isHost?n("button",{on:{click:e.takeRoles}},[e._v("Выдать роли")]):e._e(),e.isHost?e._e():n("button",{attrs:{disabled:e.connectionButtonDisabled},domProps:{textContent:e._s(e.connectionButtonStatus)},on:{click:e.connect}})])]),n("div",{directives:[{name:"show",rawName:"v-show",value:e.isHost,expression:"isHost"}],staticClass:"item flex-center"},[n("div",{staticClass:"drop-zone flex-center",on:{click:e.openFileDialog,drop:e.dropHandler}},[n("input",{ref:"fileDialog",attrs:{type:"file",id:"file-dialog"},on:{change:e.selectFileHandler}}),n("span",{staticClass:"filename"},[e._v(e._s(e.selectedFilename))])])])])])},s=[],a=(n("c740"),n("4160"),n("fb6a"),n("a434"),n("b0c0"),n("159b"),n("96cf"),n("1da1")),c=n("d4ec"),l=n("bee2"),u=n("262e"),f=n("2caf"),d=n("9ab4"),p=n("60a3");(function(e){e[e["NOT_CONNECTED"]=0]="NOT_CONNECTED",e[e["CONNECTION"]=1]="CONNECTION",e[e["CONNECTED"]=2]="CONNECTED",e[e["SERVE"]=3]="SERVE"})(o||(o={}));var h,v=n("a0bc"),b=n.n(v);(function(e){e[e["SET_ROLE"]=0]="SET_ROLE"})(h||(h={}));n("d3b7");var O=function(){function e(){Object(c["a"])(this,e)}return Object(l["a"])(e,null,[{key:"readFile",value:function(e){return new Promise((function(t,n){try{var o=new FileReader;o.readAsText(e),o.onloadend=function(){t(JSON.parse(o.result))}}catch(r){n(r)}}))}}]),e}(),g=function(e){Object(u["a"])(n,e);var t=Object(f["a"])(n);function n(){var e;return Object(c["a"])(this,n),e=t.apply(this,arguments),e.peer=null,e.connections=[],e.dataConnection=null,e.isHost=!1,e.isClient=!1,e.connection={status:o.NOT_CONNECTED},e.role=null,e.roles={filename:null,content:[]},e}return Object(l["a"])(n,[{key:"mounted",value:function(){var e=this;this.peer=new b.a,this.peer.on("connection",(function(t){t.on("open",(function(){e.connections.push(t)})),t.on("close",(function(){var n=e.connections.findIndex((function(e){return e.label===t.label}));n>-1&&e.connections.splice(n,1)})),t.on("error",(function(e){console.log(e)}))})),this.peer.on("error",(function(e){console.log(e)})),this.peer.on("close",(function(){}))}},{key:"serve",value:function(){this.isHost=!0}},{key:"connect",value:function(){var e=this;try{this.isClient=!0;var t=prompt("Введите идентификатор хоста","");if(null==t||""===t)throw new Error("Указанный идентификатор хоста недействителен");if(this.peer&&t){var n=this.peer.connect(t);n.on("data",(function(t){try{var n=JSON.parse(t);switch(n.event){case h.SET_ROLE:if(!n.data)throw new Error("Ошибка выдачи роли: от хоста поступило сообщение с пустой ролью");e.role=n.data;break;default:throw new Error("Неподдерживаемое событие")}}catch(o){alert(o.message)}})),n.on("error",(function(e){console.log(e)})),n.on("close",(function(){location.reload()}))}}catch(o){this.isClient=!1,alert(o.message)}}},{key:"takeRoles",value:function(){try{if(this.roles.content.length<this.connections.length+1)throw new Error("Количество ролей меньше, чем количество игроков");var e=this.shuffle(this.roles.content);this.connections.forEach((function(t){t.send(JSON.stringify({event:h.SET_ROLE,data:e.pop()}))})),this.role=e.pop()}catch(t){alert(t.message)}}},{key:"shuffle",value:function(e){return e.slice().sort((function(){return.5-Math.random()}))}},{key:"fillRoles",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,!t){e.next=6;break}return this.roles.filename=t.name,e.next=5,O.readFile(t);case 5:this.roles.content=e.sent;case 6:e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),alert(e.t0);case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"dropHandler",value:function(e){this.fillRoles(e.dataTransfer.files[0])}},{key:"selectFileHandler",value:function(e){e.target.files&&e.target.files.length>0&&this.fillRoles(e.target.files[0])}},{key:"openFileDialog",value:function(){var e=this.$refs.fileDialog;e.click()}},{key:"sessionId",get:function(){return this.peer?this.peer.id:""}},{key:"connectedUsersCount",get:function(){return this.connections.length}},{key:"userRole",get:function(){return this.role}},{key:"connectionButtonDisabled",get:function(){return this.connection.status!==o.NOT_CONNECTED}},{key:"connectionButtonStatus",get:function(){switch(this.connection.status){case o.CONNECTION:return"Подключение...";case o.CONNECTED:return"Подключено";default:return"Подключиться"}}},{key:"selectedFilename",get:function(){return this.roles.filename?this.roles.filename:"Выберите файл с ролями"}}]),n}(p["b"]);g=Object(d["a"])([p["a"]],g);var y=g,C=y,m=(n("1f96"),n("2877")),E=Object(m["a"])(C,i,s,!1,null,"0636cee8",null),w=E.exports;r["a"].config.productionTip=!1,new r["a"]({render:function(e){return e(w)}}).$mount("#app")}});
//# sourceMappingURL=app.5dfd4440.js.map